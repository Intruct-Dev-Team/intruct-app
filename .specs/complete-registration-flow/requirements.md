# Requirements Document

## Introduction

Нужно изменить onboarding так, чтобы после регистрации (sign up) пользователь не попадал сразу в основное приложение. Вместо этого он проходит дорегистрацию: вводит имя, фамилию, дату рождения и аватар (если вход через Google OAuth — значения подставляются), затем нажимает Confirm. После успешного запроса `Complete registration` пользователь считается дорегистрированным и попадает в приложение.

## Requirements

### Requirement 1 – Gating после регистрации

**User Story:** Как новый пользователь, я хочу после регистрации пройти дорегистрацию, чтобы мой профиль был заполнен перед использованием приложения.

#### Acceptance Criteria

1. WHEN пользователь завершает регистрацию (sign up) THEN система MUST направить пользователя на экран дорегистрации вместо основного приложения.
2. WHEN пользователь открывает приложение AND дорегистрация не завершена THEN система MUST направить пользователя на экран дорегистрации.
3. WHEN дорегистрация завершена THEN система MUST направить пользователя в основное приложение.

### Requirement 2 – Поля профиля и предзаполнение

**User Story:** Как пользователь, я хочу заполнить имя, фамилию, дату рождения и аватар, чтобы завершить создание профиля.

#### Acceptance Criteria

1. WHEN пользователь находится на экране дорегистрации THEN система MUST отображать поля `name`, `surname`, `birthdate` и `avatar`.
2. IF пользователь вошёл через Google OAuth THEN система MUST предзаполнить доступные значения профиля (например `name`, `surname`, `avatar`) из данных провайдера.
3. WHEN пользователь меняет предзаполненные значения THEN система MUST использовать изменённые пользователем значения.

### Requirement 3 – Завершение дорегистрации через API

**User Story:** Как пользователь, я хочу подтвердить дорегистрацию, чтобы мой профиль сохранился на сервере и я получил доступ к приложению.

#### Acceptance Criteria

1. WHEN пользователь нажимает Confirm THEN система MUST отправить запрос `POST /auth/complete-registration` с `Authorization: Bearer <token>`.
2. WHEN запрос `POST /auth/complete-registration` возвращает `200 OK` THEN система MUST считать дорегистрацию завершённой и использовать ответ `user_profile` как актуальный профиль пользователя.

### Requirement 4 – Валидация и состояния ошибок

**User Story:** Как пользователь, я хочу получать понятные ошибки при некорректном вводе или проблемах сети, чтобы я мог завершить дорегистрацию.

#### Acceptance Criteria

1. IF обязательные поля не заполнены THEN система MUST блокировать Confirm.
2. WHEN запрос `POST /auth/complete-registration` возвращает `401 Unauthorized` THEN система MUST показать ошибку авторизации и предложить повторить вход.
3. WHEN запрос `POST /auth/complete-registration` возвращает `422 Unprocessable Entity` THEN система MUST показать ошибку валидации и не переводить пользователя в основное приложение.
4. IF сеть недоступна OR запрос завершается ошибкой THEN система MUST показать ошибку и позволить повторить попытку.

## Global Assumptions

- Под “дорегистрация завершена” понимается успешный ответ `200 OK` от `POST /auth/complete-registration`.
- Формат `birthdate` отправляется как строка даты `YYYY-MM-DD`.
- Поле `avatar` в API отправляется как строка (URL или ключ/filename), без загрузки файла в этом шаге.
